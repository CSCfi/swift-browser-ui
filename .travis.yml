sudo: required
dist: xenial
language: python

install: true

git:
  depth: false
  quiet: true

services: docker

stages:
  - name: tests
    if: type IN(push, pull_request)
  - name: image
    if: type IN(pull_request)

jobs:
  include:
    - stage: tests
      name: "Python style check"
      python: 3.6
      before_script:
        - pip install tox-travis
      script: tox -e flake8
    - stage: tests
      name: "Python code security check"
      python: 3.6
      before_script:
        - pip install tox-travis
      script: tox -e bandit
    - stage: tests
      name: "Python unit tests 3.6"
      python: 3.6
      before_script:
        - pip install tox-travis
      script: tox -e pytest
    - stage: tests
      name: "Python unit tests 3.7"
      python: 3.7
      before_script:
        - pip install tox-travis
      script: tox -e pytest
    - stage: image
      name: "Image test build"
      script:
        docker build -t cscfi/swift-sharing-request:pr-latest .

notifications:
  email: false

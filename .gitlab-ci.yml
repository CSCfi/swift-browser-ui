cache:
  paths:
    - backend/.pip
    - backend/.tox
    - frontned/node_modules

stages:
  - Syntax Tests
  - Base Tests
  - UI Tests

test_syntax:
  stage: Syntax Tests
  image: python:3.6
  before_script:
    - pip --cache-dir=.pip install tox
  script:
    - tox -e flake8

test_code_security:
  stage: Syntax Tests
  image: python:3.6
  before_script:
    - pip --cache-dir=.pip install tox
  script:   
    - tox -e bandit

unit_test:
  stage: Base Tests
  image: python:3.6
  before_script:
    - pip --cache-dir=.pip install tox
  script:   
    - tox -e pytest

unit_test_37:
  stage: Base Tests
  image: python:3.7
  before_script:
    - pip --cache-dir=.pip install tox
  script:   
    - tox -e pytest

docs_test:
  stage: Base Tests
  image: python:3.6
  before_script:
    - wget https://github.com/mozilla/geckodriver/releases/download/v0.24.0/geckodriver-v0.24.0-linux64.tar.gz
    - tar -xvzf geckodriver-v0.24.0-linux64.tar.gz
    - rm geckodriver-v0.24.0-linux64.tar.gz
    - chmod +x geckodriver
    - cp geckodriver /usr/local/bin/
    - geckodriver --version
    - apt-get update
    - apt-get install firefox-esr -y
    - pip --cache-dir=.pip install tox
  script:
    - tox -e docs

UI Pytest Chrome:
  stage: UI Tests
  image: python:3.6
  before_script:
    - curl -sS -o - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add
    - echo "deb [arch=amd64]  http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list
    - apt-get -y update
    - apt-get -y install google-chrome-stable
    - wget https://chromedriver.storage.googleapis.com/75.0.3770.140/chromedriver_linux64.zip
    - unzip chromedriver_linux64.zip
    - rm chromedriver_linux64.zip
    - chmod +x chromedriver
    - cp chromedriver /usr/local/bin/
    - chromedriver --version
    - pip --cache-dir=.pip install tox
  script:
    - tox -e chrome

UI Pytest Firefox:
  stage: UI Tests
  image: python:3.6
  before_script:
    - wget https://github.com/mozilla/geckodriver/releases/download/v0.24.0/geckodriver-v0.24.0-linux64.tar.gz
    - tar -xvzf geckodriver-v0.24.0-linux64.tar.gz
    - rm geckodriver-v0.24.0-linux64.tar.gz
    - chmod +x geckodriver
    - cp geckodriver /usr/local/bin/
    - geckodriver --version
    - apt-get update
    - apt-get install firefox-esr -y
    - pip --cache-dir=.pip install tox
  script:
    - tox -e firefox

